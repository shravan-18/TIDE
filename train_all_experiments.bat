@echo off
setlocal enabledelayedexpansion
set DATASET_NAME=%1
set DATA_DIR=data/
set BASE_CKPT=checkpoints/best_model.pth
set REFINE_CKPT=checkpoints/refinement/best_refinement_model.pth
set RESULTS_DIR=results/%DATASET_NAME%/ablations

echo Running ablation studies for dataset: %DATASET_NAME%
mkdir %RESULTS_DIR% 2>nul

echo Running Base Model Ablations...

echo Running No Degradation Maps ablation...
python main.py --mode ablation --data_dir %DATA_DIR% --checkpoint %BASE_CKPT% --ablation_type no_degradation_maps --output_dir %RESULTS_DIR%/no_degradation_maps --visualize
if %ERRORLEVEL% NEQ 0 echo Failed: No Degradation Maps ablation but continuing...

echo Running Single Hypothesis ablation...
python main.py --mode ablation --data_dir %DATA_DIR% --checkpoint %BASE_CKPT% --ablation_type single_hypothesis --output_dir %RESULTS_DIR%/single_hypothesis --visualize
if %ERRORLEVEL% NEQ 0 echo Failed: Single Hypothesis ablation but continuing...

echo Running Fusion Types ablation...
python main.py --mode ablation --data_dir %DATA_DIR% --checkpoint %BASE_CKPT% --ablation_type fusion_type --output_dir %RESULTS_DIR%/fusion_types --visualize
if %ERRORLEVEL% NEQ 0 echo Failed: Fusion Types ablation but continuing...

echo Running No Diversity Loss ablation...
python main.py --mode ablation --data_dir %DATA_DIR% --checkpoint %BASE_CKPT% --ablation_type no_diversity_loss --output_dir %RESULTS_DIR%/no_diversity_loss --visualize
if %ERRORLEVEL% NEQ 0 echo Failed: No Diversity Loss ablation but continuing...

echo Running Decoder Types ablation...
python main.py --mode ablation --data_dir %DATA_DIR% --checkpoint %BASE_CKPT% --ablation_type decoder_types --output_dir %RESULTS_DIR%/decoder_types --visualize
if %ERRORLEVEL% NEQ 0 echo Failed: Decoder Types ablation but continuing...

echo Running Progressive Refinement Ablations...

echo Running Refinement Magnitude ablation...
python main.py --mode ablation --data_dir %DATA_DIR% --progressive_checkpoint %REFINE_CKPT% --ablation_type refinement_magnitude --output_dir %RESULTS_DIR%/refinement_magnitude --visualize
if %ERRORLEVEL% NEQ 0 echo Failed: Refinement Magnitude ablation but continuing...

echo Running No Refinement ablation...
python main.py --mode ablation --data_dir %DATA_DIR% --progressive_checkpoint %REFINE_CKPT% --ablation_type no_refinement --output_dir %RESULTS_DIR%/no_refinement --visualize
if %ERRORLEVEL% NEQ 0 echo Failed: No Refinement ablation but continuing...

echo All ablation studies completed for dataset: %DATASET_NAME%
